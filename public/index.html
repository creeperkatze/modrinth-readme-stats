<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="Generate fast, beautiful and consistent embeddable cards and badges for Modrinth, CurseForge, Hangar and Spigot content." />
        <meta property="og:title" content="Modfolio" />
        <meta property="og:description" content="Generate fast, beautiful and consistent embeddable cards and badges for Modrinth, CurseForge, Hangar and Spigot content." />
        <meta property="og:image" content="/favicon.svg" />
        <meta property="og:type" content="website" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <link rel="icon" type="image/x-icon" href="/favicon.ico" />
        <title>Modfolio</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script>
            tailwind.config = {
                theme: {
                    extend: {
                        colors: {
                            "modrinth-green": "#1bd96a",
                            "bg-dark": "#06060d",
                            "card-bg": "#101014",
                            "section-bg": "#1a1a1e",
                            "input-bg": "#3c3c40",
                            "border-dark": "#3a3a4a",
                            "text-primary": "#b0bac5",
                            "text-secondary": "#c4cfdd",
                            "text-muted": "#929aa3",
                            "text-bright": "#ecf9fb",
                            yellow: "#fbbf24",
                            red: "#ef4444",
                        },
                    },
                },
            };
        </script>
        <style>
            :root {
                --platform-color: #1bd96a;
            }
            body {
                background: #06060d url("/images/landing.webp");
                font-family:
                    Inter,
                    -apple-system,
                    BlinkMacSystemFont,
                    "Segoe UI",
                    Ubuntu,
                    sans-serif;
            }
            @keyframes spin {
                from {
                    transform: rotate(0deg);
                }
                to {
                    transform: rotate(360deg);
                }
            }
            .loader-icon {
                animation: spin 1s linear infinite;
            }
            /* Dynamic checkbox styling */
            .dynamic-checkbox {
                position: relative;
            }
            .dynamic-checkbox:checked {
                background-color: var(--platform-color) !important;
                border-color: var(--platform-color) !important;
            }
            .dynamic-checkbox:checked::after {
                content: "";
                position: absolute;
                left: 50%;
                top: 50%;
                width: 6px;
                height: 12px;
                border: solid #000;
                border-width: 0 2.5px 2.5px 0;
                transform: translate(-50%, -50%) rotate(45deg);
            }
            /* Dynamic range slider styling */
            input[type="range"] {
                -webkit-appearance: none;
                appearance: none;
                width: 100%;
                height: 6px;
                background: #3c3c40;
                border-radius: 3px;
                outline: none;
            }
            input[type="range"]::-webkit-slider-thumb {
                -webkit-appearance: none;
                appearance: none;
                width: 18px;
                height: 18px;
                background: var(--platform-color);
                cursor: pointer;
                border-radius: 50%;
                transition: all 0.2s;
            }
            input[type="range"]::-webkit-slider-thumb:hover {
                filter: brightness(1.2);
                transform: scale(1.1);
            }
            input[type="range"]::-moz-range-thumb {
                width: 18px;
                height: 18px;
                background: var(--platform-color);
                cursor: pointer;
                border-radius: 50%;
                border: none;
                transition: all 0.2s;
            }
            input[type="range"]::-moz-range-thumb:hover {
                filter: brightness(1.2);
                transform: scale(1.1);
            }
            .color-btn {
                width: 39px;
                height: 39px;
                padding: 0;
                border: 2px solid transparent;
                border-radius: 0.5rem;
                cursor: pointer;
                transition: all 0.2s;
                flex-shrink: 0;
            }
            .color-btn-selected {
                border-color: #fff !important;
            }
            #manualColorPickerContainer.color-btn {
                width: 39px;
                height: 39px;
                padding: 0;
                border-radius: 0.5rem;
            }
        </style>
    </head>
    <body class="min-h-screen flex flex-col justify-center items-center pt-10 px-5 pb-0 font-medium text-text-primary overflow-y-scroll">
        <div class="bg-card-bg border border-border-dark rounded-2xl p-4 lg:p-8 max-w-[1200px] w-full shadow-[0_4px_16px_rgba(0,0,0,0.4)]">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">
                <div>
                    <a href="/" class="inline-block no-underline">
                        <div class="flex items-center gap-3 mb-2">
                            <svg class="w-8 h-8" id="modfolioLogo" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                                <g id="logo-content">
                                    <rect fill="var(--platform-color)" width="60" height="20" x="5.62" y="10" ry="10" />
                                    <rect fill="var(--platform-color)" width="20" height="20" x="75.62" y="10" ry="10" />
                                    <rect fill="var(--platform-color)" width="90" height="20" x="5.62" y="70" ry="10" />
                                    <rect fill="var(--platform-color)" width="90" height="20" x="5" y="40" ry="10" />
                                </g>
                            </svg>
                            <h1 class="mb-0 leading-8 text-4xl font-extrabold" id="modfolioTitle" style="color: #1bd96a">Modfolio</h1>
                        </div>
                    </a>
                    <p class="mb-4 text-sm opacity-80">Generate fast, beautiful and consistent embeddable cards and badges for Modrinth, CurseForge, Hangar and Spigot content.</p>

                    <div class="bg-section-bg border border-border-dark rounded-xl px-4 py-2 mb-4">
                        <div class="mb-0">
                            <button id="basicToggle" class="w-full flex items-center justify-between bg-transparent text-text-secondary py-2 px-0 text-sm font-semibold border-none cursor-pointer">
                                <h2 class="text-text-secondary text-2xl font-semibold">Configuration</h2>
                                <svg id="basicChevron" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="transition-transform duration-200 rotate-180">
                                    <path d="m6 9 6 6 6-6" />
                                </svg>
                            </button>
                        </div>

                        <div id="basicContent">
                            <div class="mb-2">
                                <h3 class="text-text-secondary text-base font-semibold mt-2 mb-1">URL</h3>
                                <input type="text" id="modrinthUrl" placeholder="https://modrinth.com/mod/fabric-api" class="w-full py-2.5 px-3 bg-input-bg border-2 border-transparent rounded-xl text-text-bright text-sm font-medium transition-[border-color] duration-100 focus:outline-none focus:border-modrinth-green" />
                            </div>

                            <hr class="my-4 border-0 border-t border-border-dark relative divider" />

                            <div class="mb-2">
                                <h3 class="text-text-secondary text-base font-semibold mb-1">Platform</h3>
                                <div class="grid grid-cols-2 gap-2">
                                    <button id="platformModrinth" class="flex flex-row items-center justify-center gap-2 py-2.5 px-3 text-black border-none rounded-xl text-sm font-semibold cursor-pointer transition-[filter] duration-200 hover:brightness-110" style="background-color: #1bd96a">
                                        <span>Modrinth</span>
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 512 514">
                                            <path fill-rule="evenodd" clip-rule="evenodd" d="M503.16 323.56C514.55 281.47 515.32 235.91 503.2 190.76C466.57 54.2299 326.04 -26.8001 189.33 9.77991C83.8101 38.0199 11.3899 128.07 0.689941 230.47H43.99C54.29 147.33 113.74 74.7298 199.75 51.7098C306.05 23.2598 415.13 80.6699 453.17 181.38L411.03 192.65C391.64 145.8 352.57 111.45 306.3 96.8198L298.56 140.66C335.09 154.13 364.72 184.5 375.56 224.91C391.36 283.8 361.94 344.14 308.56 369.17L320.09 412.16C390.25 383.21 432.4 310.3 422.43 235.14L464.41 223.91C468.91 252.62 467.35 281.16 460.55 308.07L503.16 323.56Z" fill="currentColor"/>
                                            <path d="M321.99 504.22C185.27 540.8 44.7501 459.77 8.11011 323.24C3.84011 307.31 1.17 291.33 0 275.46H43.27C44.36 287.37 46.4699 299.35 49.6799 311.29C53.0399 323.8 57.45 335.75 62.79 347.07L101.38 323.92C98.1299 316.42 95.39 308.6 93.21 300.47C69.17 210.87 122.41 118.77 212.13 94.7601C229.13 90.2101 246.23 88.4401 262.93 89.1501L255.19 133C244.73 133.05 234.11 134.42 223.53 137.25C157.31 154.98 118.01 222.95 135.75 289.09C136.85 293.16 138.13 297.13 139.59 300.99L188.94 271.38L174.07 231.95L220.67 184.08L279.57 171.39L296.62 192.38L269.47 219.88L245.79 227.33L228.87 244.72L237.16 267.79C237.16 267.79 253.95 285.63 253.98 285.64L277.7 279.33L294.58 260.79L331.44 249.12L342.42 273.82L304.39 320.45L240.66 340.63L212.08 308.81L162.26 338.7C187.8 367.78 226.2 383.93 266.01 380.56L277.54 423.55C218.13 431.41 160.1 406.82 124.05 361.64L85.6399 384.68C136.25 451.17 223.84 484.11 309.61 461.16C371.35 444.64 419.4 402.56 445.42 349.38L488.06 364.88C457.17 431.16 398.22 483.82 321.99 504.22Z" fill="currentColor"/>
                                        </svg>
                                    </button>
                                    <button id="platformCurseforge" class="flex flex-1 flex-row items-center justify-center gap-2 py-2.5 px-3 bg-input-bg text-text-bright border border-border-dark rounded-xl text-sm font-semibold cursor-pointer transition-[filter] duration-200 hover:brightness-110">
                                        <span>CurseForge</span>
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 32 32">
                                            <path fill="currentColor" d="M23.9074 12.0181C23.9074 12.0181 30.0327 11.0522 31 8.23523H21.6168V6H1L3.53975 8.94699V11.9664C3.53975 11.9664 9.94812 11.6332 12.427 13.5129C15.8202 16.6579 8.61065 20.9092 8.61065 20.9092L7.37439 25C9.30758 23.1593 12.9921 20.7781 19.7474 20.8929C17.1767 21.7053 14.5917 22.9743 12.5794 25H26.2354L24.9494 20.9092C24.9494 20.9092 15.0519 15.0732 23.9074 12.0184V12.0181Z"/>
                                        </svg>
                                    </button>
                                    <button id="platformHangar" class="flex flex-1 flex-row items-center justify-center gap-2 py-2.5 px-3 bg-input-bg text-text-bright border border-border-dark rounded-xl text-sm font-semibold cursor-pointer transition-[filter] duration-200 hover:brightness-110">
                                        <span>Hangar</span>
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 100 100">
                                            <path fill="currentColor" d="M19.647842,83.405742 17.12912,74.376763 A 59.915284,59.915284 111.54946 0 1 44.240174,5.7251991 L 75.468532,18.867133 A 60.386505,60.386505 111.11049 0 0 48.971728,87.497785 l 2.034591,8.269181 z"/>
                                            <path fill="currentColor" d="M 55.072512,91.798362 54.544897,85.324719 C 53.694865,74.895151 58.0742,59.624658 64.887713,51.683707 c 4.017964,-4.682809 10.680248,-7.18546 13.990839,-7.389636 l -19.219377,-8.186282 -2.747207,3.929736 a 49.625159,49.625159 102.44905 0 0 -8.190353,37.100386 l 2.354013,13.270894 z" transform="translate(0.3680297)"/>
                                            <path fill="currentColor" d="m 60.114589,66.945795 23.681507,9.563685 0.139558,-0.915404 A 72.656565,72.656565 89.437067 0 0 83.706626,52.28424 l -0.08143,-0.47171 A 6.8911511,6.8911511 19.183097 0 0 72.237752,47.850769 47.237471,47.237471 122.89221 0 0 60.47418,66.039903 z"/>
                                        </svg>
                                    </button>
                                    <button id="platformSpigot" class="flex flex-1 flex-row items-center justify-center gap-2 py-2.5 px-3 bg-input-bg text-text-bright border border-border-dark rounded-xl text-sm font-semibold cursor-pointer transition-[filter] duration-200 hover:brightness-110">
                                        <span>Spigot</span>
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 100 100">
                                            <path fill="currentColor" d="m 2.9249314,78.6965 19.0096116,2.096489 a 9.5836714,9.5836714 165.41404 0 0 6.611126,-1.720339 10.495337,10.495337 176.508 0 1 9.251253,-0.564534 l 0.960623,0.2926 a 37.398702,37.398702 3.992193 0 0 16.719233,1.166833 l 14.64982,-2.308783 a 7.9513851,7.9513851 38.283424 0 1 9.164967,7.233751 l 0.938917,11.99131 1.278149,0.376424 a 23.099912,23.099912 173.63632 0 0 17.773461,-1.982205 l 0.02843,-0.01585 -1.15514,-16.787234 A 20.841075,20.841075 51.653295 0 0 83.54127,60.001265 L 68.817419,55.431375 A 5.8337525,5.8337525 52.823892 0 1 64.715192,50.022208 L 64.515708,42.85892 a 3.3667732,3.3667732 112.62429 0 1 1.062628,-2.549752 l 0.808928,-0.758473 A 1.9407677,1.9407677 114.62655 0 0 66.99885,38.21651 l 0.08632,-2.051581 a 0.55247117,0.55247117 136.25907 0 1 0.553032,-0.529245 l 0.541849,0.001 a 0.96576066,0.96576066 134.63993 0 0 0.967493,-0.97973 l -0.04871,-3.366841 a 1.0872176,1.0872176 44.377732 0 0 -1.094991,-1.07146 l -2.062221,0.01496 a 7.2051818,7.2051818 19.358924 0 1 -4.599666,-1.616092 l -2.11075,-1.717409 a 5.630161,5.630161 64.566732 0 1 -2.076803,-4.36719 l -1e-6,-2.293747 a 5.082877,5.082877 126.39522 0 1 3.57902,-4.855313 l 0.193636,-0.05997 a 15.012664,15.012664 176.8037 0 1 7.259213,-0.405383 l 7.744056,1.479633 a 3.6433349,3.6433349 165.60129 0 0 3.006805,-0.771944 l 0.256792,-0.212545 A 6.1957624,6.1957624 94.524381 0 0 79.895421,6.5485418 6.5770737,6.5770737 12.774878 0 0 72.856265,4.9525302 L 67.000902,6.843094 A 8.7476383,8.7476383 9.9043485 0 1 58.963362,5.4396901 L 55.396909,2.6829449 A 5.0273,5.0273 1.5807105 0 0 49.471901,2.5194407 L 44.175759,6.165011 A 4.762533,4.762533 168.89168 0 1 40.458825,6.8948048 L 30.310112,4.6774388 a 6.2941033,6.2941033 163.96838 0 0 -5.746298,1.651157 l -0.323842,0.3169969 a 5.406473,5.406473 102.67933 0 0 -1.290297,5.7351423 l 0.635115,1.721242 a 4.173668,4.173668 29.747764 0 0 4.658371,2.662237 l 9.188404,-1.661717 a 10.7262,10.7262 10.78609 0 1 7.564799,1.44116 4.8554895,4.8554895 66.76881 0 1 1.966931,4.582303 L 46.759033,24.3563 A 2.1432634,2.1432634 120.48794 0 1 45.7761,26.025791 l -3.809492,2.440234 a 6.7504395,6.7504395 163.43372 0 1 -3.58337,1.065952 l -1.876142,0.01605 a 1.556823,1.556823 134.5592 0 0 -1.543465,1.567399 l 0.0099,1.446444 a 1.3004363,1.3004363 49.745371 0 0 1.077225,1.27226 1.9010333,1.9010333 53.161199 0 1 1.491144,1.990442 l -0.02045,0.73725 a 2.5108794,2.5108794 69.410205 0 0 0.666679,1.77463 4.0955218,4.0955218 70.294175 0 1 1.007071,2.811739 l -1e-6,4.133108 a 10.039651,10.039651 117.10552 0 1 -4.168447,8.143926 l -0.750183,0.540829 a 5.240243,5.240243 179.36985 0 1 -6.034769,0.06637 l -1.2696,-0.873507 A 4.1062743,4.1062743 15.167796 0 0 24.34442,52.446566 L 2.6554892,54.036668 A 1.8238983,1.8238983 132.92263 0 0 0.96495069,55.854464 L 0.95114283,76.49158 A 2.2167967,2.2167967 48.165905 0 0 2.9249314,78.6965 Z" transform="translate(0.16030833,-0.57488003)"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>

                            <hr class="my-4 border-0 border-t border-border-dark relative divider" />

                            <div class="mb-2">
                                <h3 class="text-text-secondary text-base font-semibold mb-1">Type</h3>
                                <select id="embedType" class="w-full py-2.5 px-3 bg-input-bg border-2 border-transparent rounded-xl text-text-bright text-sm font-medium transition-[border-color] duration-100 focus:outline-none focus:border-modrinth-green">
                                    <option value="card">Card</option>
                                    <option value="badge">Badge</option>
                                </select>
                            </div>

                            <div class="mb-2">
                                <h3 class="text-text-secondary text-base font-semibold mb-1">Target</h3>
                                <select id="targetType" class="w-full py-2.5 px-3 bg-input-bg border-2 border-transparent rounded-xl text-text-bright text-sm font-medium transition-[border-color] duration-100 focus:outline-none focus:border-modrinth-green">
                                    <option value="user">User</option>
                                    <option value="project">Project</option>
                                    <option value="organization">Organization</option>
                                    <option value="collection">Collection</option>
                                </select>
                            </div>

                            <div class="mb-2 hidden" id="badgeSection">
                                <h3 class="text-text-secondary text-base font-semibold mb-1">Badge Metric</h3>
                                <select id="badgeMetric" class="w-full py-2.5 px-3 bg-input-bg border-2 border-transparent rounded-xl text-text-bright text-sm font-medium transition-[border-color] duration-100 focus:outline-none focus:border-modrinth-green">
                                    <option value="downloads">Downloads</option>
                                    <option value="followers">Followers</option>
                                    <option value="versions">Versions</option>
                                    <option value="views">Views</option>
                                    <option value="rank">Rank</option>
                                    <option value="projects">Projects</option>
                                </select>
                            </div>

                            <div class="mb-2">
                                <h3 class="text-text-secondary text-base font-semibold mb-1" id="valueLabel">Value</h3>
                                <input type="text" id="identifier" placeholder="Enter username or project slug" class="w-full py-2.5 px-3 bg-input-bg border-2 border-transparent rounded-xl text-text-bright text-sm font-medium transition-[border-color] duration-100 focus:outline-none focus:border-modrinth-green" />
                            </div>
                        </div>
                    </div>

                    <div class="bg-section-bg border border-border-dark rounded-xl px-4 py-2 mb-4 mb-4">
                        <div class="mb-0">
                            <button id="customizationToggle" class="w-full flex items-center justify-between bg-transparent text-text-secondary py-2 px-0 text-sm font-semibold border-none cursor-pointer">
                                <h2 class="text-text-secondary text-2xl font-semibold">Customization</h2>
                                <svg id="customizationChevron" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="transition-transform duration-200">
                                    <path d="m6 9 6 6 6-6" />
                                </svg>
                            </button>
                        </div>

                        <div id="customizationContent" class="hidden mt-2">
                            <div class="mb-2" id="showProjectsSection">
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="checkbox" id="showProjects" checked class="dynamic-checkbox !w-[18px] h-[18px] min-w-[18px] flex-shrink-0 appearance-none bg-input-bg border-2 border-text-muted rounded cursor-pointer relative transition-all duration-200 p-0" />
                                    <span class="text-base text-text-secondary">Show Projects</span>
                                </label>
                            </div>

                            <div class="mb-2" id="maxProjectsSection">
                                <div class="flex justify-between items-center mb-2">
                                    <h3 class="text-text-secondary text-base font-semibold">Max Projects</h3>
                                    <span class="dynamic-color text-base font-bold" id="maxProjectsValue">5</span>
                                </div>
                                <input type="range" id="maxProjects" min="1" max="10" value="5" class="w-full" />
                            </div>

                            <div class="mb-2 hidden" id="showVersionsSection">
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="checkbox" id="showVersions" checked class="dynamic-checkbox !w-[18px] h-[18px] min-w-[18px] flex-shrink-0 appearance-none bg-input-bg border-2 border-text-muted rounded cursor-pointer relative transition-all duration-200 p-0" />
                                    <span class="text-base text-text-secondary" id="showVersionsLabel">Show Versions</span>
                                </label>
                            </div>

                            <div class="mb-2 hidden" id="maxVersionsSection">
                                <div class="flex justify-between items-center">
                                    <h3 class="text-text-secondary text-base font-semibold" id="maxVersionsLabel">Max Versions</h3>
                                    <span class="dynamic-color text-base font-bold" id="maxVersionsValue">5</span>
                                </div>
                                <input type="range" id="maxVersions" min="1" max="10" value="5" class="w-full" />
                            </div>

                            <div class="mb-2 hidden" id="relativeTimeSection">
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="checkbox" id="relativeTime" checked class="dynamic-checkbox !w-[18px] h-[18px] min-w-[18px] flex-shrink-0 appearance-none bg-input-bg border-2 border-text-muted rounded cursor-pointer relative transition-all duration-200 p-0" />
                                    <span class="text-base text-text-secondary">Relative Time</span>
                                </label>
                            </div>

                            <div class="mb-2 hidden" id="showSparklinesSection">
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="checkbox" id="showSparklines" checked class="dynamic-checkbox !w-[18px] h-[18px] min-w-[18px] flex-shrink-0 appearance-none bg-input-bg border-2 border-text-muted rounded cursor-pointer relative transition-all duration-200 p-0" />
                                    <span class="text-base text-text-secondary">Sparkline Graphs</span>
                                </label>
                            </div>

                            <div class="mb-2">
                                <h3 class="text-text-secondary text-base font-semibold mb-1">Accent Color</h3>
                                <div class="flex flex-wrap items-center gap-2">
                                    <div id="colorButtons" class="flex flex-wrap gap-2"></div>

                                    <div id="manualColorPickerContainer" class="color-btn relative flex items-center justify-center bg-input-bg overflow-hidden border-2 border-border-dark">
                                        <input type="color" id="manualColorPicker" value="#1bd96a" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" />

                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="pointer-events-none text-text-secondary">
                                            <path d="M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z" />
                                            <path d="m15 5 4 4" />
                                        </svg>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-2">
                                <h3 class="text-text-secondary text-base font-semibold mb-1">Background Color</h3>
                                <div class="flex flex-wrap items-center gap-2">
                                    <div id="bgColorButtons" class="flex flex-wrap gap-2"></div>

                                    <div id="manualBgColorPickerContainer" class="color-btn relative flex items-center justify-center bg-input-bg overflow-hidden border-2 border-border-dark">
                                        <input type="color" id="manualBgColorPicker" value="#ffffff" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" />

                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="pointer-events-none text-text-secondary">
                                            <path d="M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z" />
                                            <path d="m15 5 4 4" />
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex flex-col gap-4">
                    <div>
                        <h2 class="flex justify-between items-center text-text-secondary text-lg font-semibold">
                            <span>Preview</span>
                            <span class="flex items-center gap-1">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-yellow hidden" id="generationIcon">
                                    <path d="M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z" />
                                </svg>
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-yellow loader-icon hidden" id="loaderIcon"><path d="M21 12a9 9 0 1 1-6.219-8.56" /></svg>
                                <span id="generationTime" class="text-yellow"></span>
                            </span>
                        </h2>
                        <div id="apiSlowWarning" class="hidden mb-3 bg-yellow/10 border border-yellow/30 rounded-lg px-3 py-2 text-sm text-yellow">
                            <span class="flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-triangle-alert-icon lucide-triangle-alert">
                                    <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3" />
                                    <path d="M12 9v4" />
                                    <path d="M12 17h.01" />
                                </svg>
                                <span id="apiSlowWarningText">The Modrinth API is responding slowly. Embeds may take longer to load.</span>
                            </span>
                        </div>
                        <div id="apiErrorWarning" class="hidden mb-3 bg-red/10 border border-red/30 rounded-lg px-3 py-2 text-sm text-red">
                            <span class="flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-alert-icon lucide-circle-alert">
                                    <circle cx="12" cy="12" r="10"/>
                                    <line x1="12" x2="12" y1="8" y2="12"/>
                                    <line x1="12" x2="12.01" y1="16" y2="16"/>
                                </svg>
                                <span id="apiErrorWarningText">The Modrinth API is currently down. Check <a href="https://status.modrinth.com" target="_blank" class="underline hover:text-red-80">status.modrinth.com</a> for updates.</span>
                            </span>
                        </div>
                        <div class="bg-section-bg border border-border-dark rounded-xl min-h-[460px] flex items-center justify-center text-text-muted p-4" id="previewContainer">
                            <span id="previewPlaceholder">Your embed will appear here</span>
                            <a id="previewLink" href="" target="_blank" class="hidden">
                                <img id="previewImg" src="" alt="Preview" class="max-w-full" />
                            </a>
                        </div>
                    </div>

                    <div>
                        <h2 class="text-text-secondary text-lg font-semibold">Markdown</h2>
                        <div class="bg-section-bg border border-border-dark rounded-xl p-3 flex items-center font-mono text-xs break-all text-text-muted" id="markdownOutput">
                            <span id="markdownPlaceholder">Your markdown code will appear here</span>
                        </div>
                    </div>

                    <div>
                        <h2 class="text-text-secondary text-lg font-semibold">HTML</h2>
                        <div class="bg-section-bg border border-border-dark rounded-xl p-3 flex items-center font-mono text-xs break-all text-text-muted" id="htmlOutput">
                            <span id="htmlPlaceholder">Your HTML code will appear here</span>
                        </div>
                    </div>

                    <div>
                        <h2 class="text-text-secondary text-lg font-semibold">URL</h2>
                        <div class="bg-section-bg border border-border-dark rounded-xl p-3 flex items-center font-mono text-xs break-all text-text-muted" id="urlOutput">
                            <span id="urlPlaceholder">Your URL will appear here</span>
                        </div>
                    </div>

                    <div class="flex flex-wrap gap-2">
                        <button class="py-2.5 px-4 text-black border-none rounded-xl text-sm font-semibold cursor-pointer transition-[filter] duration-200 hover:brightness-110 flex items-center gap-2 disabled:bg-input-bg disabled:text-text-primary disabled:opacity-50 disabled:cursor-not-allowed" onclick="copyMarkdown()" id="copyMarkdownBtn" disabled>
                            <span>Copy Markdown</span>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-brackets-icon lucide-brackets">
                                <path d="M16 3h3a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1h-3" />
                                <path d="M8 21H5a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h3" />
                            </svg>
                        </button>

                        <button class="py-2.5 px-4 text-black border-none rounded-xl text-sm font-semibold cursor-pointer transition-[filter] duration-200 hover:brightness-110 flex items-center gap-2 disabled:bg-input-bg disabled:text-text-primary disabled:opacity-50 disabled:cursor-not-allowed" onclick="copyHtml()" id="copyHtmlBtn" disabled>
                            <span>Copy HTML</span>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-code-icon lucide-code">
                                <path d="m16 18 6-6-6-6" />
                                <path d="m8 6-6 6 6 6" />
                            </svg>
                        </button>

                        <button class="py-2.5 px-4 text-black border-none rounded-xl text-sm font-semibold cursor-pointer transition-[filter] duration-200 hover:brightness-110 flex items-center gap-2 disabled:bg-input-bg disabled:text-text-primary disabled:opacity-50 disabled:cursor-not-allowed" onclick="copyUrl()" id="copyUrlBtn" disabled>
                            <span>Copy URL</span>
                            <svg id="Discord-Logo" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 126.644 96" fill="currentColor">
                                <path
                                    d="M81.15,0c-1.2376,2.1973-2.3489,4.4704-3.3591,6.794-9.5975-1.4396-19.3718-1.4396-28.9945,0-.985-2.3236-2.1216-4.5967-3.3591-6.794-9.0166,1.5407-17.8059,4.2431-26.1405,8.0568C2.779,32.5304-1.6914,56.3725.5312,79.8863c9.6732,7.1476,20.5083,12.603,32.0505,16.0884,2.6014-3.4854,4.8998-7.1981,6.8698-11.0623-3.738-1.3891-7.3497-3.1318-10.8098-5.1523.9092-.6567,1.7932-1.3386,2.6519-1.9953,20.281,9.547,43.7696,9.547,64.0758,0,.8587.7072,1.7427,1.3891,2.6519,1.9953-3.4601,2.0457-7.0718,3.7632-10.835,5.1776,1.97,3.8642,4.2683,7.5769,6.8698,11.0623,11.5419-3.4854,22.3769-8.9156,32.0509-16.0631,2.626-27.2771-4.496-50.9172-18.817-71.8548C98.9811,4.2684,90.1918,1.5659,81.1752.0505l-.0252-.0505ZM42.2802,65.4144c-6.2383,0-11.4159-5.6575-11.4159-12.6535s4.9755-12.6788,11.3907-12.6788,11.5169,5.708,11.4159,12.6788c-.101,6.9708-5.026,12.6535-11.3907,12.6535ZM84.3576,65.4144c-6.2637,0-11.3907-5.6575-11.3907-12.6535s4.9755-12.6788,11.3907-12.6788,11.4917,5.708,11.3906,12.6788c-.101,6.9708-5.026,12.6535-11.3906,12.6535Z"
                                />
                            </svg>
                        </button>

                        <button id="resetBtn" class="py-2.5 px-4 bg-input-bg text-text-bright border border-border-dark rounded-xl text-sm font-semibold flex items-center gap-2 hover:brightness-110 cursor-pointer transition-[filter] duration-200">
                            <span>Reset</span>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" />
                                <path d="M3 3v5h5" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <footer class="text-center py-8 px-5 pt-8 text-base text-text-muted font-semibold">
            Made with &hearts; by <a href="https://github.com/creeperkatze" target="_blank" class="dynamic-link no-underline" id="footerAuthorLink">Creeperkatze</a> · View <a href="https://github.com/creeperkatze/modfolio" target="_blank" class="dynamic-link no-underline" id="footerSourceLink">Source</a> ·
            <a href="https://github.com/creeperkatze/modfolio" target="_blank" class="no-underline" style="color: #fbbf24">&starf; On Github</a> · Not affiliated with Modrinth, CurseForge, Hangar or Spigot
        </footer>
        <script>
            const modrinthUrl = document.getElementById("modrinthUrl");
            const embedType = document.getElementById("embedType");
            const targetType = document.getElementById("targetType");
            const badgeSection = document.getElementById("badgeSection");
            const badgeMetric = document.getElementById("badgeMetric");
            const identifier = document.getElementById("identifier");
            const previewContainer = document.getElementById("previewContainer");
            const previewPlaceholder = document.getElementById("previewPlaceholder");
            const previewLink = document.getElementById("previewLink");
            const previewImg = document.getElementById("previewImg");
            const markdownOutput = document.getElementById("markdownOutput");
            const markdownPlaceholder = document.getElementById("markdownPlaceholder");
            const htmlOutput = document.getElementById("htmlOutput");
            const htmlPlaceholder = document.getElementById("htmlPlaceholder");
            const urlOutput = document.getElementById("urlOutput");
            const urlPlaceholder = document.getElementById("urlPlaceholder");
            const copyMarkdownBtn = document.getElementById("copyMarkdownBtn");
            const copyHtmlBtn = document.getElementById("copyHtmlBtn");
            const copyUrlBtn = document.getElementById("copyUrlBtn");
            const resetBtn = document.getElementById("resetBtn");
            const showProjects = document.getElementById("showProjects");
            const maxProjects = document.getElementById("maxProjects");
            const maxProjectsValue = document.getElementById("maxProjectsValue");
            const showVersions = document.getElementById("showVersions");
            const maxVersions = document.getElementById("maxVersions");
            const maxVersionsValue = document.getElementById("maxVersionsValue");
            const relativeTime = document.getElementById("relativeTime");
            const colorButtons = document.getElementById("colorButtons");
            const manualColorPicker = document.getElementById("manualColorPicker");
            const manualColorPickerContainer = document.getElementById("manualColorPickerContainer");
            const bgColorButtons = document.getElementById("bgColorButtons");
            const manualBgColorPicker = document.getElementById("manualBgColorPicker");
            const manualBgColorPickerContainer = document.getElementById("manualBgColorPickerContainer");
            const showProjectsSection = document.getElementById("showProjectsSection");
            const maxProjectsSection = document.getElementById("maxProjectsSection");
            const showVersionsSection = document.getElementById("showVersionsSection");
            const maxVersionsSection = document.getElementById("maxVersionsSection");
            const relativeTimeSection = document.getElementById("relativeTimeSection");
            const showSparklines = document.getElementById("showSparklines");
            const showSparklinesSection = document.getElementById("showSparklinesSection");
            const platformModrinth = document.getElementById("platformModrinth");
            const platformCurseforge = document.getElementById("platformCurseforge");
            const platformHangar = document.getElementById("platformHangar");
            const platformSpigot = document.getElementById("platformSpigot");
            const urlLabel = document.getElementById("urlLabel");
            const valueLabel = document.getElementById("valueLabel");

            // Platform configuration (mirrors backend PLATFORMS constant)
            const PLATFORMS = {
                modrinth: {
                    id: "modrinth",
                    name: "Modrinth",
                    defaultColor: "1bd96a",
                    baseUrl: "modrinth.com",
                    projectPath: "mod",
                    targets: ["user", "project", "organization", "collection"],
                    badgeMetrics: {
                        user: ["downloads", "followers", "projects"],
                        project: ["downloads", "followers", "versions"],
                        organization: ["downloads", "followers", "projects"],
                        collection: ["downloads", "followers", "projects"]
                    }
                },
                curseforge: {
                    id: "curseforge",
                    name: "CurseForge",
                    defaultColor: "F16436",
                    baseUrl: "curseforge.com",
                    projectPath: "minecraft/mc-mods",
                    userPath: "members",
                    targets: ["user", "project"],
                    badgeMetrics: {
                        project: ["downloads", "rank", "versions"],
                        user: ["downloads", "projects", "followers"]
                    }
                },
                hangar: {
                    id: "hangar",
                    name: "Hangar",
                    defaultColor: "3371ED",
                    baseUrl: "hangar.papermc.io",
                    projectPath: "plugins",
                    targets: ["user", "project"],
                    badgeMetrics: {
                        user: ["downloads", "projects", "stars"],
                        project: ["downloads", "versions", "views"]
                    }
                },
                spigot: {
                    id: "spigot",
                    name: "Spigot",
                    defaultColor: "E8A838",
                    baseUrl: "spigotmc.org",
                    projectPath: "resources",
                    targets: ["author", "resource"],
                    badgeMetrics: {
                        author: ["downloads", "resources", "rating"],
                        resource: ["downloads", "likes", "rating", "versions"]
                    }
                }
            };

            let selectedColor = "1bd96a";
            let selectedBgColor = null;
            let selectedPlatform = "modrinth";
            let curseforgeSlug = null;

            // HSL to Hex conversion (S=100%, L=75%)
            function hslToHex(h) {
                const s = 1,
                    l = 0.75;
                const c = (1 - Math.abs(2 * l - 1)) * s;
                const x = c * (1 - Math.abs(((h / 60) % 2) - 1));
                const m = l - c / 2;
                let r, g, b;

                if (h < 60) {
                    r = c;
                    g = x;
                    b = 0;
                } else if (h < 120) {
                    r = x;
                    g = c;
                    b = 0;
                } else if (h < 180) {
                    r = 0;
                    g = c;
                    b = x;
                } else if (h < 240) {
                    r = 0;
                    g = x;
                    b = c;
                } else if (h < 300) {
                    r = x;
                    g = 0;
                    b = c;
                } else {
                    r = c;
                    g = 0;
                    b = x;
                }

                const toHex = (val) =>
                    Math.round((val + m) * 255)
                        .toString(16)
                        .padStart(2, "0");
                return toHex(r) + toHex(g) + toHex(b);
            }

            function getColors() {
                return [PLATFORMS[selectedPlatform].defaultColor, ...[0, 30, 60, 150, 180, 210, 240, 270, 330].map((h) => hslToHex(h))];
            }

            let colors = getColors();

            function createColorButton(color, container) {
                const btn = document.createElement("button");
                btn.className = "color-btn" + (color === selectedColor ? " color-btn-selected" : "");
                btn.style.background = `#${color}`;
                btn.dataset.color = color;
                btn.onclick = () => {
                    selectedColor = color;
                    manualColorPicker.value = `#${color}`;

                    manualColorPickerContainer.style.background = `#${color}`;
                    manualColorPickerContainer.classList.remove("color-btn-selected");

                    document.querySelectorAll("[data-color]").forEach((b) => {
                        b.classList.toggle("color-btn-selected", b.dataset.color === selectedColor);
                    });

                    generate();
                    updateUrl();
                };
                container.appendChild(btn);
            }

            colors.forEach((color) => {
                createColorButton(color, colorButtons);
            });

            // Create background color buttons (transparent + predefined colors)
            const bgColors = [
                { name: "transparent", value: null },
                { name: "white", value: "ffffff" },
                { name: "black", value: "000000" },
            ];

            function createBgColorButton(colorObj, container) {
                const btn = document.createElement("button");
                const isSelected = selectedBgColor === colorObj.value;
                btn.className = "color-btn" + (isSelected ? " color-btn-selected" : "");

                if (colorObj.value === null) {
                    // Transparent button with checkerboard pattern
                    btn.style.background = `
                        linear-gradient(45deg, #ccc 25%, transparent 25%),
                        linear-gradient(-45deg, #ccc 25%, transparent 25%),
                        linear-gradient(45deg, transparent 75%, #ccc 75%),
                        linear-gradient(-45deg, transparent 75%, #ccc 75%)
                    `;
                    btn.style.backgroundPosition = "0 0, 0 10px, 10px -10px, -10px 0px";
                    btn.style.backgroundSize = "20px 20px";
                    btn.title = "Transparent";
                } else {
                    btn.style.background = `#${colorObj.value}`;
                }

                btn.dataset.bgColor = colorObj.value;
                btn.onclick = () => {
                    selectedBgColor = colorObj.value;

                    if (colorObj.value !== null) {
                        manualBgColorPicker.value = `#${colorObj.value}`;
                        manualBgColorPickerContainer.style.background = `#${colorObj.value}`;
                    }

                    manualBgColorPickerContainer.classList.remove("color-btn-selected");

                    document.querySelectorAll("[data-bg-color]").forEach((b) => {
                        b.classList.toggle("color-btn-selected", b.dataset.bgColor === String(selectedBgColor));
                    });

                    generate();
                    updateUrl();
                };
                container.appendChild(btn);
            }

            bgColors.forEach((colorObj) => {
                createBgColorButton(colorObj, bgColorButtons);
            });

            // Update warning messages based on platform
            function updateWarningMessages() {
                const config = PLATFORMS[selectedPlatform];
                const slowWarningText = document.getElementById("apiSlowWarningText");
                const errorWarningText = document.getElementById("apiErrorWarningText");

                slowWarningText.textContent = `The ${config.name} API is responding slowly. Embeds may take longer to load.`;
                errorWarningText.innerHTML = `The ${config.name} API is currently down. Check <a href="https://status.${config.baseUrl.toLowerCase()}" target="_blank" class="underline hover:text-red-80">status.${config.baseUrl.toLowerCase()}</a> for updates.`;
            }

            // Update labels based on platform
            function updateLabels() {
                const showVersionsLabel = document.getElementById("showVersionsLabel");
                const maxVersionsLabel = document.getElementById("maxVersionsLabel");

                if (selectedPlatform === "curseforge") {
                    showVersionsLabel.textContent = "Show Files";
                    maxVersionsLabel.textContent = "Max Files";
                } else if (selectedPlatform === "hangar" || selectedPlatform === "spigot") {
                    showVersionsLabel.textContent = "Show Versions";
                    maxVersionsLabel.textContent = "Max Versions";
                } else {
                    showVersionsLabel.textContent = "Show Versions";
                    maxVersionsLabel.textContent = "Max Versions";
                }
            }

            // Platform toggle
            function setPlatform(platform) {
                const config = PLATFORMS[platform];
                selectedPlatform = platform;
                selectedColor = config.defaultColor;

                // Update platform UI (colors, buttons, etc.)
                updatePlatformTheme(platform);
                // Update target dropdown
                updateTargetDropdown(platform);
                // Update color options
                updateColorOptions(platform);

                updateWarningMessages();
                updateLabels();
                updateUI();
                updateUrl();
            }

            // Update platform-specific UI theme (colors, buttons, etc.)
            function updatePlatformTheme(platform) {
                const config = PLATFORMS[platform];

                // Base classes for platform buttons
                const baseClass = "flex flex-1 flex-row items-center justify-center gap-2 py-2.5 px-3 rounded-xl text-sm font-semibold cursor-pointer transition-[filter] duration-200 hover:brightness-110";
                const inactiveClass = `${baseClass} bg-input-bg text-text-bright border border-border-dark`;
                const activeClass = `${baseClass} text-black border-none`;

                // Helper to add # prefix if needed
                const withHash = (color) => color.startsWith("#") ? color : `#${color}`;

                // Update button styles with dynamic colors
                const setActiveStyle = (element, color, isActive) => {
                    element.className = isActive ? activeClass : inactiveClass;
                    element.style.backgroundColor = isActive ? withHash(color) : "";
                };

                setActiveStyle(platformModrinth, PLATFORMS.modrinth.defaultColor, platform === "modrinth");
                setActiveStyle(platformCurseforge, PLATFORMS.curseforge.defaultColor, platform === "curseforge");
                setActiveStyle(platformHangar, PLATFORMS.hangar.defaultColor, platform === "hangar");
                setActiveStyle(platformSpigot, PLATFORMS.spigot.defaultColor, platform === "spigot");

                const platformColor = withHash(config.defaultColor);

                // Update copy buttons with platform color (only when enabled)
                const copyBtns = [copyMarkdownBtn, copyHtmlBtn, copyUrlBtn];
                copyBtns.forEach(btn => {
                    if (!btn.disabled) {
                        btn.style.backgroundColor = platformColor;
                    } else {
                        btn.style.backgroundColor = "";
                    }
                });

                // Update checkboxes with platform color
                document.querySelectorAll(".dynamic-checkbox").forEach(checkbox => {
                    checkbox.style.accentColor = platformColor;
                });

                // Update color value labels with platform color
                document.querySelectorAll(".dynamic-color").forEach(label => {
                    label.style.color = platformColor;
                });

                // Update title color
                const modfolioTitle = document.getElementById("modfolioTitle");
                if (modfolioTitle) {
                    modfolioTitle.style.color = platformColor;
                }

                // Update footer links color
                document.querySelectorAll(".dynamic-link").forEach(link => {
                    link.style.color = platformColor;
                });

                // Update CSS custom property
                document.documentElement.style.setProperty("--platform-color", platformColor);

                // Update favicon
                const faviconSvg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><g fill="${platformColor}"><rect width="60" height="20" x="5.62" y="10" ry="10"/><rect width="20" height="20" x="75.62" y="10" ry="10"/><rect width="90" height="20" x="5.62" y="70" ry="10"/><rect width="90" height="20" x="5" y="40" ry="10"/></g></svg>`;
                const faviconUrl = `data:image/svg+xml,${encodeURIComponent(faviconSvg)}`;
                let faviconLink = document.querySelector('link[rel="icon"][type="image/svg+xml"]');
                if (!faviconLink) {
                    faviconLink = document.querySelector('link[rel="icon"]');
                }
                if (faviconLink) {
                    faviconLink.href = faviconUrl;
                }
            }

            // Update target type dropdown for platform
            function updateTargetDropdown(platform) {
                const config = PLATFORMS[platform];
                targetType.innerHTML = config.targets.map(t => `<option value="${t}">${t.charAt(0).toUpperCase() + t.slice(1)}</option>`).join('');
                targetType.value = config.targets[0];
            }

            // Update color options for platform
            function updateColorOptions(platform) {
                const config = PLATFORMS[platform];
                selectedColor = config.defaultColor;

                // Update URL placeholder
                modrinthUrl.placeholder = `https://www.${config.baseUrl}/${config.projectPath}/example`;

                colors = getColors();
                colorButtons.innerHTML = "";
                colors.forEach((color) => {
                    createColorButton(color, colorButtons);
                });

                manualColorPicker.value = `#${selectedColor}`;
                manualColorPickerContainer.style.background = `#${selectedColor}`;
                document.querySelectorAll("[data-color]").forEach((b) => {
                    b.classList.toggle("color-btn-selected", b.dataset.color === selectedColor);
                });
            }

            // Reset to defaults for the current platform
            function resetToDefaults() {
                const config = PLATFORMS[selectedPlatform];
                const defaultColor = config.defaultColor;

                // Reset slug storage
                curseforgeSlug = null;

                // Reset embed type and target
                embedType.value = "card";
                targetType.value = config.targets[0];
                badgeMetric.value = config.badgeMetrics[config.targets[0]][0] || "downloads";
                identifier.value = "";

                // Reset customization options
                showProjects.checked = true;
                maxProjects.value = 5;
                maxProjectsValue.textContent = "5";

                showVersions.checked = true;
                maxVersions.value = 5;
                maxVersionsValue.textContent = "5";

                relativeTime.checked = true;
                showSparklines.checked = true;

                // Reset colors
                selectedColor = defaultColor;
                selectedBgColor = null;

                // Update color picker UI
                colors = getColors();
                colorButtons.innerHTML = "";
                colors.forEach((color) => {
                    createColorButton(color, colorButtons);
                });

                manualColorPicker.value = `#${selectedColor}`;
                manualColorPickerContainer.style.background = `#${selectedColor}`;
                manualColorPickerContainer.classList.remove("color-btn-selected");

                document.querySelectorAll("[data-color]").forEach((b) => {
                    b.classList.toggle("color-btn-selected", b.dataset.color === selectedColor);
                });

                // Reset background color picker
                manualBgColorPicker.value = "#ffffff";
                manualBgColorPickerContainer.style.background = "transparent";
                manualBgColorPickerContainer.classList.remove("color-btn-selected");

                document.querySelectorAll("[data-bg-color]").forEach((b) => {
                    b.classList.toggle("color-btn-selected", b.dataset.bgColor === "null");
                });

                // Reset URL
                modrinthUrl.value = "";

                updateUI();
                updateUrl();
                generate();
            }

            platformModrinth.addEventListener("click", () => {
                setPlatform("modrinth");
                resetToDefaults();
            });
            platformCurseforge.addEventListener("click", () => {
                setPlatform("curseforge");
                resetToDefaults();
            });
            platformHangar.addEventListener("click", () => {
                setPlatform("hangar");
                resetToDefaults();
            });
            platformSpigot.addEventListener("click", () => {
                setPlatform("spigot");
                resetToDefaults();
            });

            // Reset button
            resetBtn.addEventListener("click", resetToDefaults);

            // Basic section toggle
            const basicToggle = document.getElementById("basicToggle");
            const basicContent = document.getElementById("basicContent");
            const basicChevron = document.getElementById("basicChevron");
            let basicExpanded = true;

            basicToggle.addEventListener("click", () => {
                basicExpanded = !basicExpanded;
                basicContent.classList.toggle("hidden", !basicExpanded);
                basicChevron.classList.toggle("rotate-180", basicExpanded);
            });

            // Customization toggle
            const customizationToggle = document.getElementById("customizationToggle");
            const customizationContent = document.getElementById("customizationContent");
            const customizationChevron = document.getElementById("customizationChevron");
            let customizationExpanded = false;

            customizationToggle.addEventListener("click", () => {
                customizationExpanded = !customizationExpanded;
                customizationContent.classList.toggle("hidden", !customizationExpanded);
                customizationChevron.classList.toggle("rotate-180", customizationExpanded);
            });

            manualColorPicker.addEventListener("input", (e) => {
                selectedColor = e.target.value.substring(1);

                manualColorPickerContainer.style.background = `#${selectedColor}`;

                // deselect all preset buttons
                document.querySelectorAll("[data-color]").forEach((b) => {
                    b.classList.remove("color-btn-selected");
                });

                // select manual picker
                manualColorPickerContainer.classList.add("color-btn-selected");

                generate();
                updateUrl();
            });

            manualBgColorPicker.addEventListener("input", (e) => {
                selectedBgColor = e.target.value.substring(1);

                manualBgColorPickerContainer.style.background = `#${selectedBgColor}`;

                // deselect all preset buttons
                document.querySelectorAll("[data-bg-color]").forEach((b) => {
                    b.classList.remove("color-btn-selected");
                });

                // select manual picker
                manualBgColorPickerContainer.classList.add("color-btn-selected");

                generate();
                updateUrl();
            });
            // URL state management functions
            function getUrlParams() {
                const params = new URLSearchParams(window.location.search);
                const platform = params.get("platform") || "modrinth";
                const config = PLATFORMS[platform];
                return {
                    platform,
                    type: params.get("type") || "card",
                    target: params.get("target") || config.targets[0],
                    metric: params.get("metric") || "downloads",
                    value: params.get("value") || "",
                    showProjects: params.get("showProjects") !== "false",
                    maxProjects: parseInt(params.get("maxProjects")) || 5,
                    showVersions: params.get("showVersions") !== "false",
                    maxVersions: parseInt(params.get("maxVersions")) || 5,
                    relativeTime: params.get("relativeTime") !== "false",
                    showSparklines: params.get("showSparklines") !== "false",
                    color: params.get("color") || config.defaultColor,
                    backgroundColor: params.get("backgroundColor") || null,
                };
            }

            function updateUrl() {
                const params = new URLSearchParams();
                const config = PLATFORMS[selectedPlatform];
                const type = embedType.value;
                const target = targetType.value;
                const metric = badgeMetric.value;
                const value = identifier.value.trim();

                if (selectedPlatform !== "modrinth") params.set("platform", selectedPlatform);
                if (type !== "card") params.set("type", type);
                params.set("target", target);
                if (metric !== "downloads") params.set("metric", metric);
                if (value) params.set("value", value);

                // Only add customization params for cards
                if (type === "card") {
                    const isUserOrgOrCollection = ["user", "organization", "collection"].includes(target);
                    const isModrinthUserOrg = selectedPlatform === "modrinth" && isUserOrgOrCollection;
                    const isCurseforgeUser = selectedPlatform === "curseforge" && target === "user";
                    const isHangarUser = selectedPlatform === "hangar" && target === "user";
                    const isSpigotAuthor = selectedPlatform === "spigot" && target === "author";
                    const supportsProjects = isModrinthUserOrg || isCurseforgeUser || isHangarUser || isSpigotAuthor;
                    if (!showProjects.checked && supportsProjects) params.set("showProjects", "false");
                    if (maxProjects.value !== "5" && supportsProjects) params.set("maxProjects", maxProjects.value);
                    if (!showVersions.checked) params.set("showVersions", "false");
                    if (maxVersions.value !== "5") params.set("maxVersions", maxVersions.value);
                    if (!relativeTime.checked) params.set("relativeTime", "false");
                    if (!showSparklines.checked) params.set("showSparklines", "false");
                    if (selectedColor !== config.defaultColor) params.set("color", selectedColor);
                    if (selectedBgColor !== null) params.set("backgroundColor", selectedBgColor);
                } else {
                    if (selectedColor !== config.defaultColor) params.set("color", selectedColor);
                    if (selectedBgColor !== null) params.set("backgroundColor", selectedBgColor);
                }

                const newUrl = params.toString() ? `${window.location.pathname}?${params.toString()}` : window.location.pathname;
                window.history.replaceState(null, "", newUrl);
            }

            function loadFromUrl() {
                const params = getUrlParams();

                // Set platform theme and dropdown first
                updatePlatformTheme(params.platform);
                updateTargetDropdown(params.platform);

                // Now set all the values from URL params
                selectedPlatform = params.platform;
                embedType.value = params.type;
                targetType.value = params.target;
                badgeMetric.value = params.metric;
                identifier.value = params.value;

                // Show/hide projects checkbox
                showProjects.checked = params.showProjects;
                maxProjects.value = params.maxProjects;
                maxProjectsValue.textContent = params.maxProjects;

                // Show/hide versions checkbox
                showVersions.checked = params.showVersions;
                maxVersions.value = params.maxVersions;
                maxVersionsValue.textContent = params.maxVersions;

                // Other options
                relativeTime.checked = params.relativeTime;
                showSparklines.checked = params.showSparklines;
                selectedColor = params.color;
                selectedBgColor = params.backgroundColor;

                // Update color options
                updateColorOptions(params.platform);
                // Override with URL colors if specified
                if (params.color) {
                    selectedColor = params.color;
                    manualColorPicker.value = `#${selectedColor}`;
                    manualColorPickerContainer.style.background = `#${selectedColor}`;
                    const isPresetColor = colors.includes(selectedColor);
                    manualColorPickerContainer.classList.toggle("color-btn-selected", !isPresetColor);
                    document.querySelectorAll("[data-color]").forEach((b) => {
                        b.classList.toggle("color-btn-selected", b.dataset.color === selectedColor);
                    });
                }

                // Background color from URL
                if (params.backgroundColor !== null) {
                    selectedBgColor = params.backgroundColor;
                    manualBgColorPicker.value = `#${selectedBgColor}`;
                    manualBgColorPickerContainer.style.background = `#${selectedBgColor}`;
                    const isPresetBgColor = bgColors.some((c) => String(c.value) === String(selectedBgColor));
                    manualBgColorPickerContainer.classList.toggle("color-btn-selected", !isPresetBgColor && selectedBgColor !== null);
                    document.querySelectorAll("[data-bg-color]").forEach((b) => {
                        b.classList.toggle("color-btn-selected", b.dataset.bgColor === String(selectedBgColor));
                    });
                }

                // Expand customization if needed
                if (hasCustomizationFromUrl(params)) {
                    customizationExpanded = true;
                    customizationContent.classList.remove("hidden");
                    customizationChevron.classList.add("rotate-180");
                }

                // Update labels and warnings
                updateWarningMessages();
                updateLabels();
                updateUI();

                // Generate the card with loaded params
                generate();
            }

            function parseModrinthUrl(url) {
                try {
                    const urlObj = new URL(url);

                    // Check which platform this URL belongs to
                    const platform = Object.values(PLATFORMS).find(p => urlObj.hostname.includes(p.baseUrl));

                    if (platform && platform.id === "curseforge") {
                        // Handle CurseForge URLs:
                        // /minecraft/mc-mods/geckolib (project)
                        // /members/username (user - username will be shown but ID is required)
                        const pathParts = urlObj.pathname.split("/").filter((p) => p);
                        if (pathParts.length < 2) return null;

                        const firstPart = pathParts[0];
                        if (firstPart === "members" && pathParts[1]) {
                            // /members/username - user (note: API requires numeric ID, not username)
                            return { type: "user", id: pathParts[1], isCurseForge: true, needsId: true };
                        } else if (pathParts.length >= 3) {
                            // /minecraft/mc-mods/slug - project
                            const slug = pathParts[2];
                            if (slug) {
                                return { type: "project", id: slug, slug, isCurseForge: true };
                            }
                        }
                        return null;
                    }

                    if (platform && platform.id === "hangar") {
                        // Handle Hangar URLs: /plugins/ExamplePlugin or /username or /username/project
                        const pathParts = urlObj.pathname.split("/").filter((p) => p);
                        if (pathParts.length < 1) return null;
                        const firstPart = pathParts[0];
                        if (firstPart === "plugins" && pathParts[1]) {
                            // /plugins/ExamplePlugin
                            return { type: "project", id: pathParts[1], slug: pathParts[1] };
                        } else if (pathParts[1]) {
                            // /username/project (scoped project)
                            return { type: "project", id: pathParts[1], slug: pathParts[1] };
                        } else {
                            // Single path part is a username
                            return { type: "user", id: firstPart };
                        }
                    }

                    if (platform && platform.id === "spigot") {
                        // Handle Spigot URLs:
                        // /resources/example-resource.12345
                        // /resources/authors/username.12345
                        const pathParts = urlObj.pathname.split("/").filter((p) => p);
                        if (pathParts.length < 2) return null;

                        // Check for author URLs: /resources/authors/username.12345
                        if (pathParts[0] === "resources" && pathParts[1] === "authors" && pathParts[2]) {
                            const match = pathParts[2].match(/\.(\d+)$/);
                            if (match) {
                                return { type: "author", id: match[1] };
                            }
                            if (/^\d+$/.test(pathParts[2])) {
                                return { type: "author", id: pathParts[2] };
                            }
                        }
                        // Check for resource URLs: /resources/example-resource.12345
                        else if (pathParts[0] === "resources" && pathParts[1]) {
                            const match = pathParts[1].match(/\.(\d+)$/);
                            if (match) {
                                return { type: "resource", id: match[1] };
                            }
                            if (/^\d+$/.test(pathParts[1])) {
                                return { type: "resource", id: pathParts[1] };
                            }
                        }
                        return null;
                    }

                    if (!platform || platform.id !== "modrinth") return null;

                    // Handle Modrinth URLs
                    const pathParts = urlObj.pathname.split("/").filter((p) => p);
                    if (pathParts.length < 2) return null;

                    const type = pathParts[0];
                    const id = pathParts[1];

                    // Map URL types to our target types
                    const typeMap = {
                        project: "project",
                        mod: "project",
                        modpack: "project",
                        shader: "project",
                        resourcepack: "project",
                        datapack: "project",
                        plugin: "project",
                        user: "user",
                        organization: "organization",
                        collection: "collection",
                    };

                    const mappedType = typeMap[type];
                    if (!mappedType) return null;

                    return { type: mappedType, id };
                } catch {
                    return null;
                }
            }

            modrinthUrl.addEventListener("input", async () => {
                const urlValue = modrinthUrl.value.trim();

                // Auto-detect platform from URL
                const platform = Object.values(PLATFORMS).find(p => urlValue.includes(p.baseUrl));
                const parsed = parseModrinthUrl(urlValue);
                if (platform && parsed) {
                    // Set platform directly without calling setPlatform to avoid premature generate() call
                    if (selectedPlatform !== platform.id) {
                        selectedPlatform = platform.id;
                        selectedColor = PLATFORMS[platform.id].defaultColor;
                        // Update platform UI elements only (skip updateUI/updateUrl which call generate)
                        updatePlatformTheme(platform.id);
                        updateTargetDropdown(platform.id);
                        updateColorOptions(platform.id);
                        updateWarningMessages();
                        updateLabels();
                    }
                    // Set the parsed type
                    targetType.value = parsed.type;

                    // For CurseForge, silently resolve slug/username to ID in background
                    if (parsed.isCurseForge) {
                        if (parsed.type === "project" && parsed.slug) {
                            // Project slug lookup
                            curseforgeSlug = parsed.slug;
                            fetch(`/curseforge/lookup/${encodeURIComponent(parsed.slug)}`)
                                .then(res => {
                                    if (!res.ok) throw new Error("Lookup failed");
                                    return res.json();
                                })
                                .then(data => {
                                    if (data.id) {
                                        identifier.value = data.id;
                                        updateUrl();
                                        generate();
                                    } else {
                                        curseforgeSlug = null;
                                    }
                                })
                                .catch(() => {
                                    curseforgeSlug = null;
                                });
                        } else if (parsed.type === "user") {
                            // User username lookup
                            curseforgeSlug = parsed.id;
                            fetch(`/curseforge/lookup/user/${encodeURIComponent(parsed.id)}`)
                                .then(res => {
                                    if (!res.ok) throw new Error("Lookup failed");
                                    return res.json();
                                })
                                .then(data => {
                                    if (data.id) {
                                        identifier.value = data.id;
                                        updateUrl();
                                        generate();
                                    } else {
                                        curseforgeSlug = null;
                                    }
                                })
                                .catch(() => {
                                    curseforgeSlug = null;
                                });
                        } else {
                            curseforgeSlug = null;
                            identifier.value = parsed.id;
                            updateUI();
                            updateUrl();
                        }
                    } else {
                        curseforgeSlug = null;
                        identifier.value = parsed.id;
                        // Now safely call updateUI and updateUrl with correct values
                        updateUI();
                        updateUrl();
                    }
                }
            });

            function updateBadgeOptions() {
                const config = PLATFORMS[selectedPlatform];
                const metrics = config.badgeMetrics[targetType.value] || config.badgeMetrics.project;
                const metricLabels = {
                    downloads: "Downloads",
                    followers: "Followers",
                    projects: "Projects",
                    rank: "Rank",
                    stars: "Stars",
                    versions: "Versions",
                    views: "Views",
                    likes: "Likes",
                    resources: "Resources",
                    rating: "Rating"
                };
                badgeMetric.innerHTML = metrics.map(m => `<option value="${m}">${metricLabels[m]}</option>`).join('');
            }

            function updateUI() {
                const config = PLATFORMS[selectedPlatform];
                const placeholders = {
                    user: "Enter username or id",
                    project: "Enter project ID or slug",
                    organization: "Enter organization slug or id",
                    collection: "Enter collection id",
                    author: "Enter author ID",
                    resource: "Enter resource ID",
                };
                identifier.placeholder = placeholders[targetType.value] || "";
                const valueLabels = {
                    user: "Username",
                    project: selectedPlatform === "curseforge" || selectedPlatform === "spigot" ? "Project ID" : "Project Slug",
                    organization: "Organization Slug",
                    collection: "Collection ID",
                    author: "Author ID",
                    resource: "Resource ID",
                };
                valueLabel.textContent = valueLabels[targetType.value] || "Value";
                const isCard = embedType.value === "card";
                const isBadge = embedType.value === "badge";

                badgeSection.classList.toggle("hidden", !isBadge);
                updateBadgeOptions();

                // Show/hide customization sections based on target type
                const isProject = targetType.value === "project" || targetType.value === "resource";
                const isUserOrgOrCollection = ["user", "organization", "collection"].includes(targetType.value);
                const isHangarUser = selectedPlatform === "hangar" && targetType.value === "user";
                const isSpigotAuthor = selectedPlatform === "spigot" && targetType.value === "author";

                showProjectsSection.classList.toggle("hidden", !(isCard && (isUserOrgOrCollection || isHangarUser || isSpigotAuthor)));
                maxProjectsSection.classList.toggle("hidden", !(isCard && (isUserOrgOrCollection || isHangarUser || isSpigotAuthor) && showProjects.checked));
                showVersionsSection.classList.toggle("hidden", !(isCard && isProject));
                maxVersionsSection.classList.toggle("hidden", !(isCard && isProject && showVersions.checked));
                relativeTimeSection.classList.toggle("hidden", !(isCard && isProject && showVersions.checked));
                showSparklinesSection.classList.toggle("hidden", !isCard);

                generate();
            }

            async function generate() {
                const startTime = performance.now();
                const type = targetType.value;
                const identifierValue = identifier.value.trim();

                if (!identifierValue) {
                    previewContainer.classList.add("text-text-muted");
                    previewPlaceholder.classList.remove("hidden");
                    previewLink.classList.add("hidden");
                    markdownOutput.classList.add("text-text-muted");
                    markdownOutput.innerHTML = '<span id="markdownPlaceholder">Your markdown code will appear here</span>';
                    htmlOutput.classList.add("text-text-muted");
                    htmlOutput.innerHTML = '<span id="htmlPlaceholder">Your HTML code will appear here</span>';
                    urlOutput.classList.add("text-text-muted");
                    urlOutput.innerHTML = '<span id="urlPlaceholder">Your URL will appear here</span>';

                    // Disable buttons and clear inline styles so gray background shows
                    [copyMarkdownBtn, copyHtmlBtn, copyUrlBtn].forEach(btn => {
                        btn.disabled = true;
                        btn.style.backgroundColor = "";
                    });
                    document.getElementById("generationTime").textContent = "";
                    document.getElementById("generationIcon").classList.add("hidden");
                    document.getElementById("loaderIcon").classList.add("hidden");
                    document.getElementById("apiSlowWarning").classList.add("hidden");
                    document.getElementById("apiErrorWarning").classList.add("hidden");
                    return;
                }

                // Show loader and placeholder while fetching
                document.getElementById("loaderIcon").classList.remove("hidden");
                document.getElementById("generationIcon").classList.add("hidden");
                document.getElementById("generationTime").textContent = "";
                document.getElementById("apiSlowWarning").classList.add("hidden");
                document.getElementById("apiErrorWarning").classList.add("hidden");
                previewContainer.classList.add("text-text-muted");
                previewPlaceholder.classList.remove("hidden");
                previewLink.classList.add("hidden");

                // Build URL with customization parameters
                const config = PLATFORMS[selectedPlatform];
                let url;
                if (embedType.value === "card") {
                    const urlParams = new URLSearchParams();
                    if (selectedPlatform === "curseforge") {
                        // CurseForge card URL: /curseforge/project/:modId or /curseforge/user/:userId
                        const isProject = type === "project";
                        const isUser = type === "user";
                        if (isProject) {
                            if (!showVersions.checked) {
                                urlParams.set("showVersions", "false");
                            }
                            if (maxVersions.value !== "5") {
                                urlParams.set("maxVersions", maxVersions.value);
                            }
                            if (!relativeTime.checked) {
                                urlParams.set("relativeTime", "false");
                            }
                            if (!showSparklines.checked) {
                                urlParams.set("showSparklines", "false");
                            }
                        } else if (isUser) {
                            if (!showProjects.checked) {
                                urlParams.set("showProjects", "false");
                            }
                            if (maxProjects.value !== "5") {
                                urlParams.set("maxProjects", maxProjects.value);
                            }
                            if (!showSparklines.checked) {
                                urlParams.set("showSparklines", "false");
                            }
                        }
                        if (selectedColor !== config.defaultColor) {
                            urlParams.set("color", selectedColor);
                        }
                        if (selectedBgColor !== null) {
                            urlParams.set("backgroundColor", selectedBgColor);
                        }
                        const queryString = urlParams.toString();
                        url = `${window.location.origin}/curseforge/${type}/${identifierValue}${queryString ? "?" + queryString : ""}`;
                    } else if (selectedPlatform === "hangar") {
                        // Hangar card URL: /hangar/project/:slug or /hangar/user/:username
                        const isProject = type === "project";
                        const isUser = type === "user";
                        if (isProject) {
                            if (!showVersions.checked) {
                                urlParams.set("showVersions", "false");
                            }
                            if (maxVersions.value !== "5") {
                                urlParams.set("maxVersions", maxVersions.value);
                            }
                            if (!relativeTime.checked) {
                                urlParams.set("relativeTime", "false");
                            }
                        } else if (isUser) {
                            if (!showProjects.checked) {
                                urlParams.set("showProjects", "false");
                            }
                            if (maxProjects.value !== "5") {
                                urlParams.set("maxProjects", maxProjects.value);
                            }
                        }
                        if (!showSparklines.checked) {
                            urlParams.set("showSparklines", "false");
                        }
                        if (selectedColor !== config.defaultColor) {
                            urlParams.set("color", selectedColor);
                        }
                        if (selectedBgColor !== null) {
                            urlParams.set("backgroundColor", selectedBgColor);
                        }
                        const queryString = urlParams.toString();
                        url = `${window.location.origin}/hangar/${type}/${identifierValue}${queryString ? "?" + queryString : ""}`;
                    } else if (selectedPlatform === "spigot") {
                        // Spigot card URL: /spigot/resource/:id or /spigot/author/:id
                        const isResource = type === "resource";
                        const isAuthor = type === "author";
                        if (isResource) {
                            if (!showVersions.checked) {
                                urlParams.set("showVersions", "false");
                            }
                            if (maxVersions.value !== "5") {
                                urlParams.set("maxVersions", maxVersions.value);
                            }
                            if (!relativeTime.checked) {
                                urlParams.set("relativeTime", "false");
                            }
                        } else if (isAuthor) {
                            if (!showProjects.checked) {
                                urlParams.set("showProjects", "false");
                            }
                            if (maxProjects.value !== "5") {
                                urlParams.set("maxProjects", maxProjects.value);
                            }
                        }
                        if (!showSparklines.checked) {
                            urlParams.set("showSparklines", "false");
                        }
                        if (selectedColor !== config.defaultColor) {
                            urlParams.set("color", selectedColor);
                        }
                        if (selectedBgColor !== null) {
                            urlParams.set("backgroundColor", selectedBgColor);
                        }
                        const queryString = urlParams.toString();
                        url = `${window.location.origin}/spigot/${type}/${identifierValue}${queryString ? "?" + queryString : ""}`;
                    } else {
                        // Modrinth card URL
                        if (!showProjects.checked && ["user", "organization", "collection"].includes(type)) {
                            urlParams.set("showProjects", "false");
                        }
                        if (maxProjects.value !== "5" && ["user", "organization", "collection"].includes(type)) {
                            urlParams.set("maxProjects", maxProjects.value);
                        }
                        if (!showVersions.checked && type === "project") {
                            urlParams.set("showVersions", "false");
                        }
                        if (maxVersions.value !== "5" && type === "project") {
                            urlParams.set("maxVersions", maxVersions.value);
                        }
                        if (!relativeTime.checked && type === "project") {
                            urlParams.set("relativeTime", "false");
                        }
                        if (!showSparklines.checked) {
                            urlParams.set("showSparklines", "false");
                        }
                        if (selectedColor !== config.defaultColor) {
                            urlParams.set("color", selectedColor);
                        }
                        if (selectedBgColor !== null) {
                            urlParams.set("backgroundColor", selectedBgColor);
                        }
                        const queryString = urlParams.toString();
                        url = `${window.location.origin}/modrinth/${type}/${identifierValue}${queryString ? "?" + queryString : ""}`;
                    }
                } else {
                    const badgeParams = new URLSearchParams();
                    if (selectedColor !== config.defaultColor) {
                        badgeParams.set("color", selectedColor);
                    }
                    if (selectedBgColor !== null) {
                        badgeParams.set("backgroundColor", selectedBgColor);
                    }
                    const badgeQuery = badgeParams.toString();
                    if (selectedPlatform === "curseforge") {
                        url = `${window.location.origin}/curseforge/${type}/${identifierValue}/${badgeMetric.value}${badgeQuery ? "?" + badgeQuery : ""}`;
                    } else if (selectedPlatform === "hangar") {
                        url = `${window.location.origin}/hangar/${type}/${identifierValue}/${badgeMetric.value}${badgeQuery ? "?" + badgeQuery : ""}`;
                    } else if (selectedPlatform === "spigot") {
                        url = `${window.location.origin}/spigot/${type}/${identifierValue}/${badgeMetric.value}${badgeQuery ? "?" + badgeQuery : ""}`;
                    } else {
                        url = `${window.location.origin}/modrinth/${type}/${identifierValue}/${badgeMetric.value}${badgeQuery ? "?" + badgeQuery : ""}`;
                    }
                }

                const fallbackUrl = selectedPlatform === "curseforge"
                    ? type === "user"
                        ? `https://www.${config.baseUrl}/${config.userPath}/${identifierValue}`
                        : `https://www.${config.baseUrl}/${config.projectPath}/${curseforgeSlug || identifierValue}`
                    : selectedPlatform === "hangar"
                    ? type === "user"
                        ? `https://${config.baseUrl}/u/${identifierValue}`
                        : `https://${config.baseUrl}/${config.projectPath}/${identifierValue}`
                    : selectedPlatform === "spigot"
                    ? type === "author"
                        ? `https://${config.baseUrl}/authors/${identifierValue}`
                        : `https://${config.baseUrl}/${config.projectPath}/${identifierValue}/`
                    : `https://modrinth.com/${type}/${identifierValue}`;

                // Fetch meta endpoint first to get correct name and URL
                let metaName = identifierValue;
                let metaUrl = null;
                try {
                    const metaPath = selectedPlatform === "curseforge"
                        ? `/curseforge/meta/${type}/${encodeURIComponent(identifierValue)}`
                        : selectedPlatform === "hangar"
                        ? `/hangar/meta/${encodeURIComponent(identifierValue)}?type=${type}`
                        : selectedPlatform === "spigot"
                        ? `/spigot/meta/${encodeURIComponent(identifierValue)}?type=${type}`
                        : `/modrinth/meta/${type}/${encodeURIComponent(identifierValue)}`;
                    const res = await fetch(metaPath);
                    if (res.ok) {
                        const data = await res.json();
                        if (data?.name) {
                            metaName = data.name;
                        }
                        if (data?.url) {
                            metaUrl = data.url;
                        }
                    }
                } catch {}

                const targetUrl = metaUrl || fallbackUrl;
                const cacheBuster = `timestamp=${Date.now()}`;
                const urlForDiscord = `${url}${url.includes("?") ? "&" : "?"}${cacheBuster}`;

                markdownOutput.classList.remove("text-text-muted");
                markdownOutput.classList.add("text-text-bright");
                markdownOutput.textContent = `[![${metaName}](${url})](${targetUrl})`;

                htmlOutput.classList.remove("text-text-muted");
                htmlOutput.classList.add("text-text-bright");
                htmlOutput.textContent = `<a href="${targetUrl}"><img src="${url}" alt="${metaName}" /></a>`;

                urlOutput.classList.remove("text-text-muted");
                urlOutput.classList.add("text-text-bright");
                urlOutput.textContent = urlForDiscord;

                // Enable buttons and restore platform color
                const currentPlatformColor = `#${PLATFORMS[selectedPlatform].defaultColor}`;
                [copyMarkdownBtn, copyHtmlBtn, copyUrlBtn].forEach(btn => {
                    btn.disabled = false;
                    btn.style.backgroundColor = currentPlatformColor;
                });

                previewImg.src = `${url}${url.includes("?") ? "&" : "?"}t=${Date.now()}`;
                previewImg.onload = async () => {
                    const endTime = performance.now();
                    const generationTime = Math.round(endTime - startTime);
                    document.getElementById("generationTime").textContent = `${generationTime}ms`;
                    document.getElementById("generationIcon").classList.remove("hidden");
                    document.getElementById("loaderIcon").classList.add("hidden");

                    // Check for API errors by looking at response headers
                    try {
                        const res = await fetch(url, { method: 'HEAD' });
                        const errorStatus = res.headers.get("X-Error-Status");
                        const apiTime = res.headers.get("X-API-Time");

                        if (errorStatus && (errorStatus.startsWith('5') || errorStatus === '502' || errorStatus === '503' || errorStatus === '504')) {
                            document.getElementById("apiErrorWarning").classList.remove("hidden");
                        } else {
                            document.getElementById("apiErrorWarning").classList.add("hidden");
                        }

                        // Show slow API warning if actual API time > 2s (not cached)
                        const apiTimeMs = apiTime?.match(/(\d+)ms/)?.[1];
                        if (apiTimeMs && parseInt(apiTimeMs) > 2000) {
                            document.getElementById("apiSlowWarning").classList.remove("hidden");
                        } else {
                            document.getElementById("apiSlowWarning").classList.add("hidden");
                        }
                    } catch {
                        document.getElementById("apiErrorWarning").classList.add("hidden");
                    }

                    // Show image after load
                    previewLink.href = targetUrl;
                    previewContainer.classList.remove("text-text-muted");
                    previewPlaceholder.classList.add("hidden");
                    previewLink.classList.remove("hidden");
                };

                previewImg.onerror = () => {
                    document.getElementById("loaderIcon").classList.add("hidden");
                    document.getElementById("generationIcon").classList.add("hidden");
                    document.getElementById("generationTime").textContent = "";
                    document.getElementById("apiSlowWarning").classList.add("hidden");

                    // Check if this is an API error by attempting to fetch the image status
                    fetch(url, { method: 'HEAD' })
                        .then(res => {
                            const errorStatus = res.headers.get("X-Error-Status");
                            if (errorStatus && (errorStatus.startsWith('5') || errorStatus === '502' || errorStatus === '503' || errorStatus === '504')) {
                                document.getElementById("apiErrorWarning").classList.remove("hidden");
                            } else {
                                document.getElementById("apiErrorWarning").classList.add("hidden");
                            }
                        })
                        .catch(() => {
                            document.getElementById("apiErrorWarning").classList.add("hidden");
                        });

                    previewContainer.classList.add("text-text-muted");
                    previewPlaceholder.classList.remove("hidden");
                    previewLink.classList.add("hidden");
                };
            }

            embedType.addEventListener("change", () => {
                updateUI();
                updateUrl();
            });
            targetType.addEventListener("change", () => {
                updateUI();
                updateUrl();
            });
            badgeMetric.addEventListener("change", () => {
                generate();
                updateUrl();
            });
            identifier.addEventListener("input", () => {
                generate();
                updateUrl();
            });
            showProjects.addEventListener("change", () => {
                updateUI();
                updateUrl();
            });
            maxProjects.addEventListener("input", () => {
                maxProjectsValue.textContent = maxProjects.value;
                generate();
                updateUrl();
            });
            showVersions.addEventListener("change", () => {
                updateUI();
                updateUrl();
            });
            maxVersions.addEventListener("input", () => {
                maxVersionsValue.textContent = maxVersions.value;
                generate();
                updateUrl();
            });
            relativeTime.addEventListener("change", () => {
                generate();
                updateUrl();
            });
            showSparklines.addEventListener("change", () => {
                generate();
                updateUrl();
            });

            function copyMarkdown() {
                const text = markdownOutput.textContent.trim();
                if (!text || text === "Your markdown code will appear here") return;

                navigator.clipboard.writeText(text).then(() => {
                    const span = copyMarkdownBtn.querySelector("span");
                    const originalText = span.textContent;
                    span.textContent = "Copied!";
                    setTimeout(() => {
                        span.textContent = originalText;
                    }, 2000);
                });
            }

            function copyHtml() {
                const text = htmlOutput.textContent.trim();
                if (!text || text === "Your HTML code will appear here") return;

                navigator.clipboard.writeText(text).then(() => {
                    const span = copyHtmlBtn.querySelector("span");
                    const originalText = span.textContent;
                    span.textContent = "Copied!";
                    setTimeout(() => {
                        span.textContent = originalText;
                    }, 2000);
                });
            }

            function copyUrl() {
                const text = urlOutput.textContent.trim();
                if (!text || text === "Your URL will appear here") return;

                navigator.clipboard.writeText(text).then(() => {
                    const span = copyUrlBtn.querySelector("span");
                    const originalText = span.textContent;
                    span.textContent = "Copied!";
                    setTimeout(() => {
                        span.textContent = originalText;
                    }, 2000);
                });
            }

            function hasCustomizationFromUrl(params) {
                const config = PLATFORMS[params.platform];
                const relevantPlatform = params.platform === "modrinth" || params.platform === "curseforge" || params.platform === "hangar" || params.platform === "spigot";
                return (relevantPlatform && params.showProjects === false) || (relevantPlatform && params.maxProjects !== 5) || params.showVersions === false || params.maxVersions !== 5 || params.relativeTime === false || params.showSparklines === false || params.color !== config.defaultColor || params.backgroundColor !== null;
            }

            loadFromUrl();
        </script>
    </body>
</html>
